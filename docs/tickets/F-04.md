# F-04 — ベースラインスモークテスト構成検討（Level 1）

## 1. 背景と狙い
- F-02 で実装されるコアユーティリティを継続的に検証するため、pytest ベースの最小スモークテストセットを構築する。
- 早期にテスト実行フローを整備し、以後のチケットで機能追加する際の品質ゲートを確保する。

## 2. スコープ
- `tests/conftest.py` を作成し、共通フィクスチャとして以下を用意:
  - `iris_frame` / `auto_mpg_frame`: `core.datasets` のローダーを利用して DataFrame を返す。
  - `tmp_results_dir`: `docs/results/tmp/<ticket-id>/` を一時的に作成し、後始末する。
- スモークテスト:
  - `tests/test_core_datasets.py`: F-02 実装を前提に、ロード関数が DataFrame を返し、行数 > 0 を確認。
  - `tests/test_core_metrics.py`: Dummy データで `evaluate_classification`, `evaluate_regression` を呼び出し、レポート値が期待レンジ内か検証。
  - `tests/test_core_visualization.py`: `scatter_plot` と `residual_plot` が `matplotlib.figure.Figure` を返し、`save_fig` でファイルが生成されることを確認。
- `pytest.ini` を追加し、`pythonpath = src` と簡易マーカー設定（`slow` 等は未設定）を記載。
- `.venv-wsl` 環境で `uv run --active pytest` のスモーク実行を行い、結果を記録。

## 3. 完了条件（チェックリスト）
- [ ] `tests/conftest.py`, `tests/test_core_datasets.py`, `tests/test_core_metrics.py`, `tests/test_core_visualization.py`, `pytest.ini` を作成。
- [ ] すべてのテストが `.venv-wsl` アクティベート状態で `uv run --active pytest` にて緑化。
- [ ] `docs/trace/F-04.md` に実行コマンド、結果、テストカバレッジの概要（対象関数）を記録。
- [ ] `docs/results/F-04.md` にスモークテスト構成、既知のテストギャップ、今後のテスト方針をまとめる。
- [ ] 一時生成した成果物（例: 図ファイル）はテスト後にクリーンアップする。

## 4. 作業ガイド
- matplotlib のバックエンドはデフォルト（Agg）を想定し、図保存時のパスは `tmp_results_dir` など一時ディレクトリを使用する。
- テスト内でハードコードするデータは小規模サンプルを利用し、将来の実装変更で壊れにくいアサーションを選定する。
- fixtures には Google スタイル docstring を付与し、再利用性を高める。

## 5. 依存関係と参照資料
- 依存: F-02（実装・API 確定待ち）
- 参照: `docs/spec/architecture.md`, `docs/spec/implementation-tasks.md`, `docs/tickets/F-02.md`

## 6. 想定担当とハンドオフ
- 担当: tester
- 完了後に結果・トレースファイルを overview のメモ欄にリンクし、judge へレビューを依頼する。
- judge はテスト範囲と記録内容を確認し、カバレッジ不足があればフォローアップ（例: F-04a）を planner に提案する。

## 7. 期待成果物
- テストコード: `tests/` 配下の新規ファイル、`pytest.ini`
- ドキュメント: `docs/results/F-04.md`
- トレース: `docs/trace/F-04.md`
