# I-01 — Iris 可視化ユーティリティ実装（Level 2）

## 1. 背景と狙い
- No3 演習課題では iris データの散布図におけるマーカー色・形の多様化が求められている。
- F 系チケットで整備したコアユーティリティを活用し、`iris/plotting.py` を可視化専用の再利用可能な API として実装する。
- 以降の KNN / K-means 実装やノートブックから同一の関数を呼び出すことで、成果物出力とスタイル統一を図る。

## 2. スコープ
- `src/ml/iris/plotting.py`
  - `SPECIES_STYLE_BANK`: 5 以上の色・マーカー・サイズ・アルファ組み合わせを定義したリストを追加。
  - `build_species_style_map(species: Sequence[str], style_bank: Sequence[dict[str, Any]] | None = None) -> dict[str, dict[str, Any]]` を実装し、種ごとに一意のスタイルを割り当てる。
  - `scatter_feature_pair(frame: pd.DataFrame, x: str, y: str, style_map: Mapping[str, dict[str, Any]], title: str, save_path: Path | str | None = None) -> matplotlib.figure.Figure` を実装。`core.visualization.save_fig` を用い、`save_path` が与えられた場合は `docs/results/figures/` 以下へ保存しパスを返却する。
  - `plot_feature_grid(frame: pd.DataFrame, feature_pairs: Sequence[tuple[str, str]], style_map: Mapping[str, dict[str, Any]], ticket_id: str, output_dir: Path | None = None) -> list[Path]` を実装。複数ペアをループし、保存パスは `docs/results/figures/<ticket_id>_<x>_<y>.png` に統一する。
  - すべての関数・モジュールに Google スタイル docstring と型ヒントを付与。
- 代表図を 1 枚以上生成し、`docs/results/figures/` に保存する（例: `docs/results/figures/I-01_petal_length_petal_width.png`）。

## 3. 完了条件（チェックリスト）
- [x] 上記関数を実装し、`build_species_style_map` が 5 種類以上のスタイルをローテーションできることを確認。
- [x] `tests/iris/test_plotting.py` を追加し、以下を検証:
  - スタイルマップのキーがユニークで、色・マーカーの組み合わせが 5 種類以上含まれること。
  - `scatter_feature_pair` が `Figure` を返し、`save_path` 指定時にファイルが生成されること。
- [x] `.venv-wsl` をアクティベートして `uv run --active pytest tests/iris/test_plotting.py` を実行。結果を `docs/trace/I-01.md` に記録。
- [x] 作成した図の一覧と利用方法を `docs/results/I-01.md` にまとめる。

## 4. 作業ガイド
- `core.datasets.load_iris_dataset()` を用いて DataFrame を取得し、`species` 列をスタイルマップに利用する。
- 色・マーカー設定は matplotlib の `'o'`, `'s'`, `'^'`, `'D'`, `'P'` などを組み合わせ、視認性を高める。
- 画像保存時は `figure.tight_layout()` を忘れず、生成パスはテストで削除できるよう `Path` を返す。
- コマンド実行時は `source .venv-wsl/bin/activate && uv run --active ...` 形式に従う。

## 5. 依存関係と参照資料
- 依存: F-02 完了
- 参照: `docs/spec/requrements.md`（No3 可視化要件）, `docs/spec/architecture.md`, `docs/spec/implementation-tasks.md`, `docs/spec/agents.md`, `docs/tickets/F-04.md`

## 6. 想定担当とハンドオフ
- 担当: coder
- 成果物とトレースをチケットメモおよび `docs/tickets/overview.md` に追記し、I-02 へ引き継ぎ可能な図生成 API を提示する。
- judge レビューに備え、`docs/results/I-01.md` に使用例と保存パスを明記する。

## 7. 期待成果物
- コード: `src/ml/iris/plotting.py`, `tests/iris/test_plotting.py`
- ドキュメント: `docs/results/I-01.md`
- トレース: `docs/trace/I-01.md`
- 図: `docs/results/figures/I-01_*.png`

## 8. 作業メモ（coder）
- 状態: Review 待ち
- 成果: `docs/results/I-01.md`, 図 `docs/results/figures/I-01_petal_length_petal_width.png`
- トレース: `docs/trace/I-01.md`
- 追加テスト: `tests/iris/test_plotting.py`
